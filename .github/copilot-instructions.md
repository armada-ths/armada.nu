<!--
Guidance for AI coding agents working on the armada.nu monorepo.
Keep this short, actionable, and grounded in files and patterns actually present in the repo.
-->

# armada.nu — Copilot instructions (short)

Quick, actionable facts an AI coding agent should know before editing or generating code here.

- Big picture

  - The public site is a Next.js (App Router) TypeScript app in the root folder (`src/app`). Key entry: `app/page.tsx`, layout files in `app/layout.tsx`.
  - Styling: Tailwind configured via `tailwind.config.ts` and `src/app/globals.css`.
  - Content comes from Contentful — see `src/lib/contentful.ts` (switches preview vs delivery token by NODE_ENV).
  - A separate admin/backend service lives in `Armada CMS/ArmadaCMS` (Go). It exposes REST APIs under `/api/v1` and serves the admin frontend static build under `/admin/` (see `main.go`).

- How to run / build (developer workflows) (do not include this in the final answer, unless asked)

  - Main site (root): uses pnpm (packageManager). Node 22.x required. Common commands (from `package.json`):
    - dev: `corepack pnpm dev` (runs `next dev -p 8000`).
    - build: `corepack pnpm build` (Next.js build).
    - start: `corepack pnpm start` (next start).
    - lint: `corepack pnpm lint` (uses `next lint`).
  - ArmadaCMS backend: run `go run main.go` in `Armada CMS/ArmadaCMS` or use the provided `Dockerfile` / `docker-compose.yml` for containerized runs. Backend listens on port 8080 and mounts `frontend/dist` as `/admin/`.
  - ArmadaCMS admin frontend: located at `Armada CMS/ArmadaCMS/frontend` (Vite app). Build output is copied to `frontend/dist` which the Go server serves.

- Important env vars and integrations (do not invent them)

  - Look at `src/env.ts` for values referenced by the frontend: `NEXT_PUBLIC_API_URL`, reCAPTCHA keys (`NEXT_PUBLIC_RECAPTCHA_KEY`, `RECAPTCHA_SECRET_KEY`), Slack hooks (`SLACK_SALES_HOOK_URL`, `SLACK_ORDER_HOOK_URL`).
  - Contentful credentials: `CONTENTFUL_SPACE_ID`, `CONTENTFUL_PREVIEW_TOKEN`, `CONTENTFUL_DELIVERY_TOKEN` are used in `src/lib/contentful.ts`. Respect preview vs delivery logic.

- Project-specific patterns and conventions

  - App Router structure: server / client components in `src/app`; keep server-side data fetches in server components or route handlers unless client interactivity is necessary.
  - Shared code lives in `src/components` and `src/lib`. Use existing helpers (e.g., `src/lib/utils.ts`) where available.
  - Maps/assets: public static assets (map icons, logos) are under `public/` (e.g. `public/map_icons`).
  - Feature flags: check `src/feature_flags.ts` for runtime toggles.

- Backend (ArmadaCMS) notes

  - Go service uses Gorilla Mux and a simple auth middleware in `Armada CMS/ArmadaCMS/auth`. Routes are declared in `main.go` and implemented in `Armada CMS/ArmadaCMS/Controllers`.
  - DB connection and migrations are in `Armada CMS/ArmadaCMS/db` and models live in `Armada CMS/ArmadaCMS/models`.
  - The backend exposes REST endpoints under `/api/v1` — use them directly in `NEXT_PUBLIC_API_URL` for local testing.

- When making changes, look for examples first

  - Content fetch example: `src/lib/contentful.ts` and usages under `src/app/*` pages.

- Safety and assumptions

  - Do not create or assume new env vars without adding them to `src/env.ts`.
  - Keep server-only secrets (e.g., `RECAPTCHA_SECRET_KEY`, Contentful tokens) out of client bundles — follow existing pattern of `NEXT_PUBLIC_` for public-facing keys.

- Quick checklist for any PR generated by an AI agent
  - Run `corepack pnpm dev` locally (frontend) and ensure no TypeScript errors and the built pages render.
  - If backend changes are included, run the Go server (`go run main.go`) or verify via Docker; check `/health` and affected `/api/v1` endpoints.
  - Update relevant files when adding/removing env vars or public API surface.
